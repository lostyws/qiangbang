define("login-register",["zepto","common"],function(t,e,a){var i=t("zepto"),r=t("common");a.exports.loginRegister=function(){function t(t){var e=/^1\d{10}$/;return e.test(t)?!0:!1}function e(e){if(e.preventDefault(),!t(i("#telNumber").val()))return r.animationTips(),s.html("请输入手机号！"),!1;var n=u.attr("data-yzm")+i("#telNumber").val();i.ajax({type:"POST",url:n,dataType:"json",success:function(t){""===t.errCode?a():"002"===t.errCode?(i(".cover-layer").show(),g[0].src=URL.captchaURL+"&_t="+ +new Date):(r.animationTips(),s.html(t.errMsg))},error:function(){r.animationTips(),s.html("网络错误")}})}function a(){0==m?(c.removeAttr("disabled"),c.html("获取验证码"),m=60):(c.attr("disabled","disabled"),c.html("重发（"+m+"）"),--m,setTimeout(a,1e3))}function n(){return i(".cover-layer input").val()?(i(".cover-layer").hide(),void i.ajax({type:"POST",url:i("#registerPage form").attr("data-yzm")+i("#telNumber").val()+"&seed="+URL.captchaURL.split("=")[1]+"&captcha="+i(".cover-layer input").val(),dataType:"json",success:function(t){a(),""===t.errCode||(animationTips(),i("#animationTips span").html(t.errMsg)),i(".cover-layer input").val("")},error:function(t){animationTips(),i("#animationTips span").html(t.errMsg),i(".cover-layer input").val("")}})):(animationTips(),i("#animationTips span").html("请输入验证码！"),!1)}var o=i(".checkbox-status").hasClass("checked"),s=i("#animationTips span"),c=i("#getBtn");i(".checkbox-status").click(function(){o?(i(this).removeClass("checked"),i(".loginFormcheckbox").prop("checked",!1),o=!1):(i(this).addClass("checked"),i(".loginFormcheckbox").prop("checked",!0),o=!0)});var l=window.localStorage;i("#telNumber").blur(function(){t(i(this).val())||(r.animationTips(),s.html("您输入的手机号格式错误！"))});var m=60,u=i("#registerPage form");i("#getBtn").bind("click",e);var d=!1,p=i(".from-item-vcode"),g=p.find("img"),h=URL.captchaURL.split("=")[1];g.on("click",function(){this.src=URL.captchaURL+"&_t="+ +new Date}),i('[name="seed"]').val(h);var f=i("#loginPage form");i(".cover-layer .vCodeVerify").on("click",n),i(".login-btn").click(function(){"need_detail"==r.getPar("from")?i.ajax({type:"post",url:f.attr("action"),data:f.serialize(),dataType:"json",success:function(t){return""==t.errCode?void(window.location.href=i("body").attr("data-url")+r.getPar("taskId")):(r.animationTips(),s.html(t.errMsg),g[0].src=URL.captchaURL+"&_t="+ +new Date,d||"401"!=t.errCode||(p.show(),d=!d,r.animationTips(),i("#animationTips").removeClass("fadeInUpBig fadeOut")),void 0)},error:function(){r.animationTips(),s.html("网络错误！")}}):(r.getPar("from")&&i('#loginPage form input[name="from"]').val(r.getPar("from")),i.ajax({type:"post",url:f.attr("action"),data:f.serialize(),dataType:"json",success:function(t){if(t.ajax)try{l.getItem("loginStatus")?(l.removeItem("loginStatus"),l.removeItem("loginFlag")):(l.setItem("loginStatus","true"),l.setItem("loginFlag","true")),window.location.href=document.referrer}catch(e){console.log(e)}else{if(""==t.errCode){try{l.getItem("loginStatus")?(l.removeItem("loginStatus"),l.removeItem("loginFlag")):(l.setItem("loginStatus","true"),l.setItem("loginFlag","true"))}catch(e){console.log(e)}return void(window.location.href=t.url)}r.animationTips(),s.html(t.errMsg),g[0].src=URL.captchaURL+"&_t="+ +new Date,d||"401"!=t.errCode||(p.show(),d=!d,r.animationTips(),i("#animationTips").removeClass("fadeInUpBig fadeOut"))}},error:function(){r.animationTips(),s.html("网络错误！")}}))}),i(".register-btn").click(function(){return"false"==i(".loginFormcheckbox").attr("checked")?(r.animationTips(),void s.html("请选择服务协议！")):void i.ajax({type:"POST",url:u.attr("action"),data:u.serialize(),dataType:"json",success:function(t){""==t.errCode?window.location.href=u.attr("data-registerSuccess"):(r.animationTips(),s.html(t.errMsg))},error:function(){r.animationTips(),s.html("网络错误！")}})}),i(".btn_back").click(function(){window.history.go(-1)}),i("#registerPage .description .register").click(function(){i("#loginPage").css("-webkit-transform","translateX(0)"),i("#registerPage").css("-webkit-transform","translateX(100%)"),location.hash=""})}});